<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>내 정보</title>
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/my-info.css}">
    <script th:src="@{/js/my-info.js}" defer></script>
</head>
<body>

<!-- 상단 바 -->
<div class="myinfo-top-bar">
    <button class="back-lobby-btn"
            type="button"
            th:onclick="|location.href='@{/lobby}'|">
        ←
    </button>

    <span th:text="'Player: ' + ${loginUser.username}">
        Player: alice
    </span>

    <span th:if="${myCharacter != null}"
          th:text="' | Character: ' + ${myCharacter.name}">
        | Character: 소드 앨리스
    </span>
</div>

<div class="myinfo-root">

    <!-- ===== LEFT: 캐릭터 스테이지 ===== -->
    <section class="char-stage">

        <div class="char-bg"></div>

        <!-- 캐릭터 반신 -->
        <div th:if="${myCharacter != null && myCharacter.portraitUrl != null}"
             class="char-portrait"
             id="char-portrait"
             th:style="|background-image: url('${myCharacter.portraitUrl}');|">
        </div>

        <!-- 좌상단 오버레이(이름/HP) -->
        <div class="char-overlay">

            <!-- 이름 -->
            <div class="char-name-block">
                <div class="char-label">OPERATOR</div>
                <div class="char-name">
                    <span th:if="${myCharacter != null}"
                          th:text="${myCharacter.name}">캐릭터 이름</span>
                    <span th:if="${myCharacter == null}">Unknown</span>
                </div>
            </div>

            <!-- HP -->
            <div class="char-hp-block" th:if="${myCharacter != null}">
                <div class="char-hp-row">
                    <span class="hp-label">HP</span>
                    <span class="hp-text"
                          th:text="${myCharacter.currentHp} + ' / ' + ${myCharacter.maxHp}">
                        97 / 200
                    </span>
                </div>

                <div class="char-hp-bar">
                    <div class="char-hp-fill"
                         th:if="${myCharacter.maxHp > 0}"
                         th:attr="style=|width:${myCharacter.currentHp * 100 / myCharacter.maxHp}%|">
                    </div>
                </div>
            </div>

            <div class="char-stats" th:if="${myCharacter != null}">

                <div class="stat-row">
                    <span class="stat-chip atk">ATK</span>
                    <span class="stat-value" th:text="${myCharacter.atk}">0</span>
                </div>

                <div class="stat-row">
                    <span class="stat-chip int">INT</span>
                    <span class="stat-value" th:text="${myCharacter.intelligence}">0</span>
                </div>

                <div class="stat-row">
                    <span class="stat-chip det">DET</span>
                    <span class="stat-value" th:text="${myCharacter.det}">0</span>
                </div>

                <div class="stat-row">
                    <span class="stat-chip hp">HP</span>
                    <span class="stat-value" th:text="${myCharacter.hp}">0</span>
                </div>

            </div>



        </div>

        <!-- ✅ 좌측 아래: 세로 배지 스택 (VN 박스 침범 X) -->
        <div class="char-action-badges" aria-label="Quick actions">
            <!-- SKILL: 패널 토글 -->
            <button type="button" class="badge-btn badge-skill" id="skill-badge-btn" aria-label="Skill">
                <span class="badge-icon" aria-hidden="true">
                    <img src="https://www.svgrepo.com/show/152773/sword.svg" alt="">
                </span>
                <span class="badge-label">SKILL</span>
            </button>

            <!-- SETTING: 링크(없으면 라우트 만들거나 버튼으로 변경) -->
            <button type="button" class="badge-btn badge-setting" id="setting-badge-btn" aria-label="Setting">
    <span class="badge-icon" aria-hidden="true">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/58/Ic_settings_48px.svg/1024px-Ic_settings_48px.svg.png" alt="">
    </span>
                <span class="badge-label">SETTING</span>
            </button>

        </div>

        <!-- VN 말풍선 -->
        <div class="vn-dialog" id="vn-dialog">
            <div class="vn-dialog-name"
                 th:text="${myCharacter != null ? myCharacter.name : '???'}">
                소드 앨리스
            </div>
            <div class="vn-dialog-text" id="vn-dialog-text">
                <span th:if="${myCharacter != null && myCharacter.randomOneLiner != null}"
                      th:text="${myCharacter.randomOneLiner}">
</span>

                <span th:if="${myCharacter == null || myCharacter.randomOneLiner == null}">
    ……괜찮아. 네가 있는 한, 난 무너지지 않아.
</span>
            </div>
        </div>

        <!-- ✅ SETTING 모달(드래그 가능) -->
        <div class="settings-backdrop" id="settings-backdrop" hidden></div>

        <section class="settings-window" id="settings-window" hidden
                 th:attr="data-one1=${myCharacter != null ? myCharacter.oneLiner1 : ''},
                  data-one2=${myCharacter != null ? myCharacter.oneLiner2 : ''},
                  data-one3=${myCharacter != null ? myCharacter.oneLiner3 : ''}">
            <header class="settings-header" id="settings-drag-handle">
                <div class="settings-title">
                    <div class="settings-label">SETTING</div>
                    <div class="settings-h1">한마디 설정</div>
                </div>

                <button type="button" class="settings-close" id="settings-close-btn" aria-label="Close">✕</button>
            </header>

            <div class="settings-body">
                <div class="settings-section-title">한마디</div>

                <label class="settings-field">
                    <span>한마디 1</span>
                    <input id="one1" type="text" maxlength="255" placeholder="예) ……괜찮아. 네가 있는 한, 난 무너지지 않아.">
                </label>

                <label class="settings-field">
                    <span>한마디 2</span>
                    <input id="one2" type="text" maxlength="255" placeholder="예) 네가 선택한 길이라면, 나도 함께 갈게.">
                </label>

                <label class="settings-field">
                    <span>한마디 3</span>
                    <input id="one3" type="text" maxlength="255" placeholder="예) 오늘도, 무사히 돌아오자.">
                </label>

                <div class="settings-actions">
                    <button type="button" class="settings-btn primary" id="settings-save-btn">저장</button>
                </div>

                <div class="settings-hint" id="settings-hint" aria-live="polite"></div>
            </div>
        </section>


    </section>

    <!-- ===== RIGHT: 스킬 패널 ===== -->
    <aside class="skill-panel" id="skill-panel">

        <header class="skill-panel-header">
            <div>
                <div class="skill-panel-label">SKILL INVENTORY</div>
                <h3>보유 스킬</h3>
            </div>
        </header>

        <div class="skill-panel-body">
            <div class="skill-list">

                <!-- 보유 스킬 목록 -->
                <th:block th:if="${myCharacter != null && !#lists.isEmpty(myCharacter.skillInventory)}">

                    <article class="skill-row"
                             th:each="s : ${myCharacter.skillInventory}">

                        <!-- 스킬 아이콘 -->
                        <div class="skill-row-icon"
                             th:if="${s.imageUrl != null}"
                             th:style="|background-image:url('${s.imageUrl}');|">
                        </div>
                        <div class="skill-row-icon" th:if="${s.imageUrl == null}"></div>

                        <div class="skill-row-main">
                            <div class="skill-row-top">
                                <span class="skill-row-name" th:text="${s.name}">스킬 이름</span>

                                <span class="skill-row-tag"
                                      th:classappend="${' tag-' + s.tag}"
                                      th:text="${s.tag}">
                                </span>
                            </div>

                            <div class="skill-row-meta"
                                 th:text="${'쿨타임 ' + s.cooldown + '턴'}">
                            </div>

                            <p class="skill-row-desc"
                               th:text="${(s.effectText != null && !#strings.isEmpty(s.effectText))
                                            ? s.effectText
                                            : s.description}">
                            </p>
                        </div>

                        <!-- 장착 버튼 -->
                        <div class="skill-row-actions">
                            <button type="button" class="equip-btn" th:attr="data-skill-code=${s.code}">장착</button>
                        </div>

                    </article>

                </th:block>

                <div th:if="${myCharacter == null || #lists.isEmpty(myCharacter.skillInventory)}"
                     style="font-size:13px; color:#aaa; padding:8px 4px;">
                    보유 스킬이 없습니다.
                </div>

            </div>
        </div>

        <!-- ===== 장착 슬롯 ===== -->
        <div class="skill-preset-bar">

            <!-- SLOT 1 -->
            <div class="preset-slot" data-slot="1">
                <div class="preset-slot-label">SLOT 1</div>

                <div class="preset-slot-body"
                     th:if="${myCharacter != null && myCharacter.equippedSkill1 != null}">

                    <div class="preset-icon"
                         th:style="|background-image:url('${myCharacter.equippedSkill1.imageUrl}');|">
                    </div>

                    <div class="preset-text">
                        <div th:text="${myCharacter.equippedSkill1.name}"></div>
                        <small th:text="'[' + ${myCharacter.equippedSkill1.tag} + ' / 쿨:' + ${myCharacter.equippedSkill1.cooldown} + ']'"></small>
                    </div>

                    <button type="button" class="unequip-btn" data-slot="1">해제</button>
                </div>

                <!-- SLOT1 비었을 때 -->
                <div class="preset-slot-body preset-empty"
                     th:if="${myCharacter == null || myCharacter.equippedSkill1 == null}">
                    <div class="preset-icon"></div>
                    <div class="preset-text">스킬을 선택하세요</div>
                </div>

            </div>

            <!-- SLOT 2 -->
            <div class="preset-slot" data-slot="2">
                <div class="preset-slot-label">SLOT 2</div>

                <div class="preset-slot-body"
                     th:if="${myCharacter != null && myCharacter.equippedSkill2 != null}">

                    <div class="preset-icon"
                         th:style="|background-image:url('${myCharacter.equippedSkill2.imageUrl}');|">
                    </div>

                    <div class="preset-text">
                        <div th:text="${myCharacter.equippedSkill2.name}"></div>
                        <small th:text="'[' + ${myCharacter.equippedSkill2.tag} + ' / 쿨:' + ${myCharacter.equippedSkill2.cooldown} + ']'"></small>
                    </div>

                    <button type="button" class="unequip-btn" data-slot="2">해제</button>
                </div>

                <!-- SLOT2 비었을 때 -->
                <div class="preset-slot-body preset-empty"
                     th:if="${myCharacter == null || myCharacter.equippedSkill2 == null}">
                    <div class="preset-icon"></div>
                    <div class="preset-text">스킬을 선택하세요</div>
                </div>

            </div>

        </div>

        <div id="equip-state"
             th:attr="data-slot1=${myCharacter != null and myCharacter.equippedSkill1 != null ? myCharacter.equippedSkill1.code : ''},
              data-slot2=${myCharacter != null and myCharacter.equippedSkill2 != null ? myCharacter.equippedSkill2.code : ''}">
        </div>

    </aside>
</div>

</body>
</html>
